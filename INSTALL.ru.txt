Инструкция по установке

Подразумевается что статистика устанавливается на ту же Windows машину где работает выделенный сервер Ил-2 БЗС.

Важно! Если на сервере установлена ROF Server Stats, установка данного ПО может нарушить её работу.


1) Скачать и установить PostgreSQL 9.5
http://www.enterprisedb.com/products-services-training/pgdownload#windows

2) Скачать и установить Python 3.5 с добавлением в path Windows
https://www.python.org/ftp/python/3.5.2/python-3.5.2.exe


3) Вместе с PostgreSQL устанавливается pgAdmin III - клиент для работы с базой данных.
С помощью клиента нужно создать в базе данных нового пользователя (например il2_stats).
Создать новую базу (например il2_stats) и назначит её владельцем пользователя созданного ранее.
Выполнить sql запрос в новую базу для подключение расширений
CREATE EXTENSION IF NOT EXISTS hstore;
CREATE EXTENSION IF NOT EXISTS citext;


4) Требуется включить логирование миссий. Для этого в раздел KEY = system файла startup.cfg нужно добавить
mission_text_log = 1
text_log_folder = "logs\txt\"

5) Настроить саму статистику через файл src/conf.ini

Статистика имеет встроенный веб сервер. Его настройки это раздел http.
С настройками по умолчанию веб интерфейс статистики будет доступен по адресу http://127.0.0.1
Вместо 127.0.0.1 может быть внешний IP адрес.
Если на сервере используется firewall - его необходимо настроить соответствующим образом.

Если на сервере уже используется какой-нибудь веб-сервер то возможны несколько вариантов:
a) Запускать сайт статистики на другом порту, например 8000
b) Проксировать запросы с основного веб сервера - в веб сервер статистики
c) Запускать сайт статистики на основном веб сервере как WSGI или FastCGI приложение. Используется фреймворк Django.
https://docs.djangoproject.com/en/1.8/howto/deployment/fastcgi/
https://docs.djangoproject.com/en/1.8/howto/deployment/wsgi/

В разделе database нужно настроить данные для доступа к базе данных.
Как правило, достаточно поменять поля name, user, password

В параметре game_server path нужно указать путь до директории куда установлена игра

В разделе stats находятся опциональные настройки статистики:
mission_report_delete - удалять ли обработанные логи игры (true / false)
mission_report_backup_days - сколько дней хранить резервные копии логов игры (они хранятся упакованные в zip архив)
inactive_player_days - сколько дней игрок не должен делать вылеты чтобы статистика исключила его из рейтинга
new_tour_by_month - активация автоматической системы туров по месяцам (true / false)
win_by_score - активация расчета победы в миссии по очкам в случае если не состоялась победа по задаче
win_score_min - минимальное кол-во очков которое должна набрать коалиция чтобы сработал расчет победы по очкам
win_score_ratio - минимальное соотношение очков двух коалиций для определения победившей коалиции

6) Далее запускаем установщик run/install.cmd
Он последовательно, с подтверждением действий, выполнит следующее:
- установит фрэймворк и библиотеки необходимые для работы статистики
- создаст таблицы в базе данных
- соберет статические файлы для веб интерфейса
- импортирует в базу информацию об игровых объектах
- предложит создать пользователя-администратора (путь к админ панели - http://адрес_сайта/admin/)

7) Если все прошло без ошибок, то установка завершена.
stats.cmd запускает парсер логов
waitress.cmd запускает встроенный веб сервер

8) в админ панели, в разделе Chunks можно будет поменять отображаемое на сайте название сервера
